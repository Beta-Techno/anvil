---
- name: Skip cleanup when disabled
  ansible.builtin.debug:
    msg: "Cleanup skipped (cleanup_run=false)."
  when: not cleanup_run

- name: Attempt apt fix
  ansible.builtin.command: apt -f install -y
  changed_when: false
  failed_when: false
  when: cleanup_run

- name: Autoremove unused packages
  ansible.builtin.apt:
    autoremove: true
  when: cleanup_run

- name: Remove downloaded temp artifacts
  ansible.builtin.shell: |
    rm -f /tmp/cursor.deb /tmp/nomachine.deb /tmp/docker-desktop.deb \
          /tmp/jetbrains-toolbox.tar.gz /tmp/JetBrainsMono.zip /tmp/go.tar.gz \
          /tmp/nvim.appimage /tmp/ghostty-install.sh /tmp/zed-install.sh
  args:
    executable: /bin/bash
  changed_when: false
  when: cleanup_run

- name: Cleanup summary
  ansible.builtin.debug:
    msg: "Cleanup run complete (cleanup_run={{ cleanup_run }})."
  when: cleanup_run
